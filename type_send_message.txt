üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Message ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (Frontend ‚Üí Backend)

  üîç ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

  Frontend ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Backend ‡∏ú‡πà‡∏≤‡∏ô 2 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:

  1. Text Message ‚Üí ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô application/json
  2. Media Message (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û, ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠, ‡πÑ‡∏ü‡∏•‡πå) ‚Üí ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô multipart/form-data

  ---
  1Ô∏è‚É£ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ (Text Only)

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: application/json

  {
    "type": "text",
    "content": "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö"
  }

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î Frontend:
  chatService.sendTextMessage(conversationId, "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö");

  ---
  2Ô∏è‚É£ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Single Image)

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: multipart/form-data

  FormData Fields:
  type: "image"
  content: "" (‡∏´‡∏£‡∏∑‡∏≠ caption ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  media[]: [File object]

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Request Body:
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="type"

  image
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="content"

  ‡∏™‡∏ß‡∏¢‡∏°‡∏≤‡∏Å! üòç
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="photo.jpg"
  Content-Type: image/jpeg

  [binary data]
  ------WebKitFormBoundary--

  ---
  3Ô∏è‚É£ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ (Multiple Images)

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: multipart/form-data

  FormData Fields:
  type: "image"
  content: "" (‡∏´‡∏£‡∏∑‡∏≠ caption ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  media[]: [File object 1]
  media[]: [File object 2]
  media[]: [File object 3]
  ...

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Request Body:
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="type"

  image
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="content"

  ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="photo1.jpg"
  Content-Type: image/jpeg

  [binary data]
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="photo2.jpg"
  Content-Type: image/jpeg

  [binary data]
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="photo3.jpg"
  Content-Type: image/jpeg

  [binary data]
  ------WebKitFormBoundary--

  ‚ö†Ô∏è Limitations:
  - ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏π‡∏õ ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB

  ---
  4Ô∏è‚É£ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (Video)

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: multipart/form-data

  FormData Fields:
  type: "video"
  content: "" (‡∏´‡∏£‡∏∑‡∏≠ caption ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  media[]: [File object]

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Request Body:
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="type"

  video
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="content"

  ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="video.mp4"
  Content-Type: video/mp4

  [binary data]
  ------WebKitFormBoundary--

  ‚ö†Ô∏è Limitations:
  - ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ 1 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  - ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100 MB
  - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

  ---
  5Ô∏è‚É£ ‡πÑ‡∏ü‡∏•‡πå (File - PDF, DOC, ZIP, etc.)

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: multipart/form-data

  FormData Fields:
  type: "file"
  content: "" (‡∏´‡∏£‡∏∑‡∏≠ caption ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
  media[]: [File object]

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Request Body:
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="type"

  file
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="content"

  ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏ç‡∏≤
  ------WebKitFormBoundary
  Content-Disposition: form-data; name="media[]"; filename="contract.pdf"
  Content-Type: application/pdf

  [binary data]
  ------WebKitFormBoundary--

  ‚ö†Ô∏è Limitations:
  - ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5 ‡πÑ‡∏ü‡∏•‡πå ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 50 MB
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: .pdf, .doc, .docx, .xls, .xlsx, .zip, .rar, .txt

  ---
  6Ô∏è‚É£ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠/‡πÑ‡∏ü‡∏•‡πå + Caption

  API Endpoint: POST /api/v1/chat/conversations/{conversationId}/messages

  Request Format: multipart/form-data

  ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ Caption:
  - content field ‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô caption text
  - ‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πá‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô media[]

  ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
  type: "image"
  content: "‡∏†‡∏≤‡∏û‡∏™‡∏ß‡∏¢‡πÜ ‡∏à‡∏≤‡∏Å‡∏ó‡∏∞‡πÄ‡∏• üåä"
  media[]: [photo1.jpg]
  media[]: [photo2.jpg]

  ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ Caption:
  - content field ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô empty string ""
  - ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡πà‡∏á field ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢

  ---
  üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Frontend)

  // 1. User ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ú‡πà‡∏≤‡∏ô ChatInput
  <ChatInput onSendMessage={handleSendMessage} />

  // 2. handleSendMessage ‡∏™‡∏£‡πâ‡∏≤‡∏á FormData
  const formData = new FormData();
  formData.append("type", files[0].type); // "image" | "video" | "file"
  if (content) formData.append("content", content);
  files.forEach(f => formData.append("media[]", f.file));

  // 3. ‡∏™‡πà‡∏á‡∏ú‡πà‡∏≤‡∏ô chatStore.sendMessage()
  await sendMessage(conversationId, formData);

  // 4. chatStore ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
  if (type === "text" && !hasFiles) {
    // ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON
    await chatService.sendTextMessage(conversationId, content);
  } else {
    // ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô multipart/form-data
    await chatService.sendMediaMessage(conversationId, formData);
  }

  ---
  ‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏à‡πâ‡∏á)

  ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏û‡∏≠‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ ‡∏°‡∏±‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏Ñ‡πà text

  ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:

  1. Backend ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö multipart/form-data ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ parse FormData
    - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend endpoint ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö multipart/form-data ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ middleware ‡∏ó‡∏µ‡πà parse file upload ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  2. Backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô media[] field
    - Frontend ‡∏™‡πà‡∏á field ‡∏ä‡∏∑‡πà‡∏≠ media[] (‡∏°‡∏µ brackets)
    - Backend ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô array
  3. Backend ‡∏°‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å request ‡πÄ‡∏õ‡πá‡∏ô text
    - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend ‡∏≠‡πà‡∏≤‡∏ô type field ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend ‡πÅ‡∏¢‡∏Å logic ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á text ‡∏Å‡∏±‡∏ö media ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

  ---
  üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Backend ‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö

  ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Text Message:
  {
    "type": "text",
    "content": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"
  }

  ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Media Message:
  Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...

  type: "image" | "video" | "file"
  content: "caption (optional)"
  media[]: File (binary)
  media[]: File (binary) // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå
  ...

  ---
  üß™ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á cURL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö

  ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏ß:
  curl -X POST "http://localhost:8080/api/v1/chat/conversations/{conversationId}/messages" \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -F "type=image" \
    -F "content=‡∏†‡∏≤‡∏û‡∏™‡∏ß‡∏¢" \
    -F "media[]=@/path/to/photo.jpg"

  ‡∏™‡πà‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ:
  curl -X POST "http://localhost:8080/api/v1/chat/conversations/{conversationId}/messages" \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -F "type=image" \
    -F "content=‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô" \
    -F "media[]=@/path/to/photo1.jpg" \
    -F "media[]=@/path/to/photo2.jpg" \
    -F "media[]=@/path/to/photo3.jpg"

  ---
  ‡∏™‡∏£‡∏∏‡∏õ: Frontend ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á Backend ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ multipart/form-data ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô media[] field

  ‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏° Backend ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:
  1. Middleware ‡∏ó‡∏µ‡πà handle file upload
  2. ‡∏Å‡∏≤‡∏£ parse media[] field ‡∏à‡∏≤‡∏Å FormData
  3. ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å logic ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á text message ‡∏Å‡∏±‡∏ö media message ‡∏ï‡∏≤‡∏° type field